#!/usr/bin/env bash

MYDIR="$(realpath "$(dirname "$(readlink -f "$0")")/../..")"
DEVDIR="$(realpath "$(dirname "$(readlink -f "$0")")/..")"

echo "#!/usr/bin/env bash" > "$HOME/.setdirs"
echo "export MYDIR=\"$MYDIR\"" >> "$HOME/.setdirs"
echo "export DEVDIR=\"$DEVDIR\"" >> "$HOME/.setdirs"

mkdir "$DEVDIR/bin"
mkdir "$DEVDIR/tmp"
mkdir "$DEVDIR/archive"

mkdir "$MYDIR/tmp"
mkdir "$MYDIR/games"
mkdir "$MYDIR/vids"
mkdir "$MYDIR/misc_programs"
mkdir "$MYDIR/misc"
mkdir "$MYDIR/scrap"

if [ "$(uname)" = "Darwin" ]
then
    if [ $(uname -m) = "arm64" ] && ! (arch -arch x86_64 uname -m > /dev/null)
    then
        softwareupdate --install-rosetta --agree-to-license
    fi
    eval $(/opt/homebrew/bin/brew shellenv)
    brew bundle install --no-upgrade --file="$DEVDIR/cfgs/Brewfile"

    defaults write com.apple.dock tilesize -int 16
    defaults write com.apple.dock size-immutable -bool true
    killall Dock
fi

python3 -m venv "$DEVDIR/.venv"

. "$DEVDIR/cfgs/bash.bash_profile"

mv -f "$DEVDIR/bin/srm" "$DEVDIR/tmp/srm_$RANDOM" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/srm" "$DEVDIR/bin/srm" > /dev/null 2> /dev/null
chmod +x "$DEVDIR/bin/srm"

srm "$DEVDIR/bin/vscin" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/vscin" "$DEVDIR/bin/vscin"
chmod +x "$DEVDIR/bin/vscin"

srm "$DEVDIR/bin/venvin" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/venvin" "$DEVDIR/bin/venvin"

srm "$HOME/.bash_profile" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/bash.bash_profile" "$HOME/.bash_profile"

mkdir -p "$HOME/.config/nvim"
srm "$HOME/.config/nvim/init.vim" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/nvim.vim" "$HOME/.config/nvim/init.vim"

mkdir -p "$HOME/.emacs.d/baks"
mkdir -p "$HOME/.emacs.d/autosaves"
cat /dev/null > "$HOME/.emacs.d/custom.el"
srm "$HOME/.emacs.d/init.el" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/emacs.el" "$HOME/.emacs.d/init.el"

srm "$HOME/.gitconfig" > /dev/null 2> /dev/null
cp "$DEVDIR/cfgs/git.gitconfig" "$HOME/.gitconfig"

